{% extends 'dashboard/base.html' %}
{% block page_title %} Bandas Emergentes {% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2><i class="fas fa-guitar text-danger me-2"></i> Bandas Emergentes</h2>
</div>

<div class="card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>Nombre</th>
            <th>Género</th>
            <th>Ciudad</th>
            <th>Contacto</th>
            <th>Estado</th>
            <th>Fecha Envío</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for banda in bandas %}
          <tr>
            <td>{{ banda.nombre_banda }}</td>
            <td>{{ banda.genero }}</td>
            <td>{{ banda.ciudad }}</td>
            <td>
              <div><i class="fas fa-envelope me-1 text-muted"></i> {{ banda.correo_contacto }}</div>
              <div><i class="fas fa-phone me-1 text-muted"></i> {{ banda.telefono_contacto|default:"No especificado" }}</div>
            </td>
            <td>
              <span class="badge 
                {% if banda.estado == 'pendiente' %} bg-warning
                {% elif banda.estado == 'aprobado' %} bg-success
                {% elif banda.estado == 'rechazado' %} bg-danger
                {% endif %}">
                {{ banda.get_estado_display }}
              </span>
            </td>
            <td>{{ banda.fecha_envio|date:"d/m/Y H:i" }}</td>
            <td>
              <!-- Botones de estado -->
              <a href="{% url 'cambiar_estado_banda' banda.id 'aprobado' %}" class="btn btn-sm btn-success">
                <i class="fas fa-check"></i>
              </a>
              <a href="{% url 'cambiar_estado_banda' banda.id 'rechazado' %}" class="btn btn-sm btn-danger">
                <i class="fas fa-times"></i>
              </a>
              <a href="{% url 'cambiar_estado_banda' banda.id 'pendiente' %}" class="btn btn-sm btn-secondary">
                <i class="fas fa-clock"></i>
              </a>

              <!-- Botón de detalle -->
              <button class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#bandaModal{{ banda.id }}">
                <i class="fas fa-eye"></i>
              </button>

              <!-- Eliminar -->
              <form method="POST" action="{% url 'delete_banda' banda.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('¿Eliminar esta banda?');">
                  <i class="fas fa-trash"></i>
                </button>
              </form>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center text-muted py-4">
              <i class="fas fa-music me-2"></i> No hay postulaciones aún.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ======================
     MODALES FUERA DE LA TABLA
======================= -->
{% for banda in bandas %}
<div class="modal fade" id="bandaModal{{ banda.id }}" tabindex="-1" aria-labelledby="bandaModalLabel{{ banda.id }}" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title" id="bandaModalLabel{{ banda.id }}">
          <i class="fas fa-music me-2"></i> {{ banda.nombre_banda }}
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <p><strong>Integrantes:</strong> {{ banda.integrantes|default:"No especificado" }}</p>
        <p><strong>Género:</strong> {{ banda.genero }}</p>
        <p><strong>Ciudad:</strong> {{ banda.ciudad|default:"No especificada" }}</p>
        <hr>
        <p><strong>Contacto:</strong></p>
        <p><i class="fas fa-envelope me-1 text-muted"></i> {{ banda.correo_contacto }}</p>
        <p><i class="fas fa-phone me-1 text-muted"></i> {{ banda.telefono_contacto|default:"No especificado" }}</p>
        <hr>
        <p><strong>Mensaje:</strong><br>{{ banda.mensaje }}</p>
        {% if banda.links %}
          <p><strong>Links:</strong><br>{{ banda.links|linebreaks }}</p>
        {% endif %}
        {% if banda.press_kit %}
          <p><strong>Press Kit:</strong> 
            <a href="{{ banda.press_kit.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
              <i class="fas fa-download"></i> Descargar
            </a>
          </p>
        {% endif %}
        <hr>
        <p><strong>Fecha de envío:</strong> {{ banda.fecha_envio|date:"d/m/Y H:i" }}</p>
        <p><strong>Estado actual:</strong> 
          <span class="badge 
            {% if banda.estado == 'pendiente' %} bg-warning
            {% elif banda.estado == 'aprobado' %} bg-success
            {% elif banda.estado == 'rechazado' %} bg-danger
            {% endif %}">
            {{ banda.get_estado_display }}
          </span>
        </p>
      </div>
      <div class="modal-footer">
        <a href="{% url 'cambiar_estado_banda' banda.id 'aprobado' %}" class="btn btn-success">
          <i class="fas fa-check"></i> Aprobar
        </a>
        <a href="{% url 'cambiar_estado_banda' banda.id 'rechazado' %}" class="btn btn-danger">
          <i class="fas fa-times"></i> Rechazar
        </a>
        <a href="{% url 'cambiar_estado_banda' banda.id 'pendiente' %}" class="btn btn-secondary">
          <i class="fas fa-clock"></i> Pendiente
        </a>
        <button type="button" class="btn btn-outline-dark" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
{% endfor %}
{% endblock %}
