<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/images/logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Radio Oriente FM - Tu radio en línea" />
    <link rel="apple-touch-icon" href="/images/logo.png" />
    <title>Radio Oriente FM</title>
  </head>
  <body>
    <noscript
      >Necesitas habilitar JavaScript para ejecutar esta aplicación.</noscript
    >
    <div id="root"></div>
    <vapi-widget
      id="vapi-widget-custom"
      public-key="ff86e4e9-7fec-4c06-886c-18d61bd33d1a"
      assistant-id="3e2b0f28-c14d-4b0d-b3d9-8eb385b31af1"
      mode="chat"
      theme="dark"
      size="compact"
      radius="large"
      base-color="#2f2f2f"
      accent-color="#ee0f0f"
      button-base-color="#000000"
      button-accent-color="#ffffff"
      main-label="RO"
      start-button-text="Start"
      end-button-text="End Chat"
      empty-chat-message="¡Hola! ¿Qué quieres saber hoy?"
      show-transcript="true"
      require-consent="true"
      terms-content="Al aceptar estas dando consentimiento de que tu chat puede ser registrado y analizado por los administradores."
      local-storage-key="vapi_widget_consent"
      position="bottom-left"
    ></vapi-widget>
    <script
      src="https://unpkg.com/@vapi-ai/client-sdk-react/dist/embed/widget.umd.js"
      async
      type="text/javascript"
    ></script>
    <style>
      /* Forzar posición del widget Vapi en móviles */
      @media (max-width: 480px) {
        vapi-widget {
          left: 0.75rem !important;
          bottom: 80px !important;
          right: auto !important;
        }

        body.player-collapsed vapi-widget {
          bottom: 1rem !important;
        }
      }

    </style>
    <script>
      // Detectar cuando el reproductor se colapsa
      function updatePlayerCollapsedClass() {
        const radioPlayer = document.querySelector(".radio-player-wrapper");
        if (radioPlayer) {
          if (radioPlayer.classList.contains("collapsed")) {
            document.body.classList.add("player-collapsed");
          } else {
            document.body.classList.remove("player-collapsed");
          }
        }
      }

      function setupPlayerObserver() {
        const radioPlayer = document.querySelector(".radio-player-wrapper");
        if (radioPlayer) {
          const observer = new MutationObserver(updatePlayerCollapsedClass);
          observer.observe(radioPlayer, {
            attributes: true,
            attributeFilter: ["class"],
          });
          updatePlayerCollapsedClass();
        }
      }

      // Forzar posición del widget Vapi (expuesta globalmente)
      window.forceVapiPosition = function() {
        const isMobile = window.innerWidth <= 480;
        if (!isMobile) return;

        const vapiWidget = document.getElementById('vapi-widget-custom');
        if (vapiWidget) {
          const radioPlayer = document.querySelector(".radio-player-wrapper");
          const isCollapsed = radioPlayer?.classList.contains("collapsed");
          const bottomValue = isCollapsed ? "1rem" : "90px";

          vapiWidget.style.setProperty('position', 'fixed', 'important');
          vapiWidget.style.setProperty('left', '0.75rem', 'important');
          vapiWidget.style.setProperty('bottom', bottomValue, 'important');
          vapiWidget.style.setProperty('right', 'auto', 'important');

          // Buscar el botón dentro del widget (puede estar en Shadow DOM)
          const allDivs = document.querySelectorAll('div[style*="position: fixed"]');
          allDivs.forEach(el => {
            const styles = window.getComputedStyle(el);
            if (styles.position === 'fixed' && el !== vapiWidget && el.closest('vapi-widget')) {
              el.style.setProperty('position', 'fixed', 'important');
              el.style.setProperty('left', '0.75rem', 'important');
              el.style.setProperty('bottom', bottomValue, 'important');
              el.style.setProperty('right', 'auto', 'important');
            }
          });
        }
      };

      // Cambiar texto del widget según tamaño de pantalla
      function updateVapiLabel() {
        const vapiWidget = document.getElementById('vapi-widget-custom');
        if (vapiWidget) {
          const isMobile = window.innerWidth <= 480;
          const newLabel = isMobile ? 'RO' : 'Habla con Radio Oriente';

          // Cambiar el atributo
          vapiWidget.setAttribute('main-label', newLabel);

          // Forzar actualización buscando el texto dentro del Shadow DOM
          setTimeout(() => {
            const shadowRoot = vapiWidget.shadowRoot;
            if (shadowRoot) {
              const buttons = shadowRoot.querySelectorAll('button');
              buttons.forEach(btn => {
                if (btn.textContent.includes('RO') || btn.textContent.includes('Habla')) {
                  btn.textContent = newLabel;
                }
              });
            }
          }, 500);
        }
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", function() {
          setupPlayerObserver();
          setTimeout(() => {
            window.forceVapiPosition();
            updateVapiLabel();
          }, 2000);
        });
      } else {
        setupPlayerObserver();
        setTimeout(() => {
          window.forceVapiPosition();
          updateVapiLabel();
        }, 2000);
      }

      window.addEventListener("resize", () => {
        window.forceVapiPosition();
        updateVapiLabel();
      });
    </script>
    <script type="module" src="/src/index.js"></script>
  </body>
</html>
